{"uid":"743142e1f891cbbf","name":"test_relation_data_is_updated_correctly_when_scaling","fullName":"tests.integration.test_db#test_relation_data_is_updated_correctly_when_scaling","historyId":"152ca49d309486a4da466866d1fc641f","time":{"start":1708480261213,"stop":1708481763411,"duration":1502198},"description":"Test that relation data, like connection data, is updated correctly when scaling.","descriptionHtml":"<p>Test that relation data, like connection data, is updated correctly when scaling.</p>\n","status":"broken","statusMessage":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/0 [idle] active: \n  postgresql/1 [idle] active: Primary\n  postgresql/2 [executing] waiting: waiting for primary to be reachable from this unit\n  postgresql/3 [executing] waiting: waiting for primary to be reachable from this unit","statusTrace":"Traceback (most recent call last):\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 493, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 115, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 152, in _multicall\n    return outcome.get_result()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 114, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 77, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 493, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 115, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 152, in _multicall\n    return outcome.get_result()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 114, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 77, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 532, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/tests/integration/test_db.py\", line 118, in test_relation_data_is_updated_correctly_when_scaling\n    await ops_test.model.wait_for_idle(\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/juju/model.py\", line 2945, in wait_for_idle\n    raise jasyncio.TimeoutError(\"Timed out waiting for model:\\n\" + busy)\nasyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/0 [idle] active: \n  postgresql/1 [idle] active: Primary\n  postgresql/2 [executing] waiting: waiting for primary to be reachable from this unit\n  postgresql/3 [executing] waiting: waiting for primary to be reachable from this unit","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop","time":{"start":1708478937500,"stop":1708478937501,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1708478937501,"stop":1708478937501,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1708478937501,"stop":1708478937798,"duration":297},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1708480261203,"stop":1708480261203,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Test that relation data, like connection data, is updated correctly when scaling.","status":"broken","statusMessage":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/0 [idle] active: \n  postgresql/1 [idle] active: Primary\n  postgresql/2 [executing] waiting: waiting for primary to be reachable from this unit\n  postgresql/3 [executing] waiting: waiting for primary to be reachable from this unit","statusTrace":"Traceback (most recent call last):\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 493, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 115, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 152, in _multicall\n    return outcome.get_result()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 114, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 77, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 493, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 115, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 152, in _multicall\n    return outcome.get_result()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 114, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 77, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 532, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/tests/integration/test_db.py\", line 118, in test_relation_data_is_updated_correctly_when_scaling\n    await ops_test.model.wait_for_idle(\n  File \"/home/ubuntu/github-runner/_work/postgresql-operator/postgresql-operator/.tox/integration/lib/python3.10/site-packages/juju/model.py\", line 2945, in wait_for_idle\n    raise jasyncio.TimeoutError(\"Timed out waiting for model:\\n\" + busy)\nasyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/0 [idle] active: \n  postgresql/1 [idle] active: Primary\n  postgresql/2 [executing] waiting: waiting for primary to be reachable from this unit\n  postgresql/3 [executing] waiting: waiting for primary to be reachable from this unit","steps":[],"attachments":[{"uid":"a4942dc85b6894d4","name":"log","source":"a4942dc85b6894d4.txt","type":"text/plain","size":13625}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"abort_on_fail::0","time":{"start":1708481763469,"stop":1708481763469,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1708484488255,"stop":1708484514551,"duration":26296},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1708484514555,"stop":1708484514574,"duration":19},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1708484514574,"stop":1708484514574,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1708484514574,"stop":1708484514584,"duration":10},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"group(1)"},{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"tests.integration"},{"name":"suite","value":"test_db"},{"name":"host","value":"large-313-b68f1cc0ede69c178399298b"},{"name":"thread","value":"14787-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.test_db"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":9,"skipped":0,"passed":11,"unknown":0,"total":20},"items":[{"uid":"8aa5d0eb26ea7853","reportUrl":"../2027//#testresult/8aa5d0eb26ea7853","status":"broken","statusDetails":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/0 [idle] active: \n  postgresql/1 [idle] active: Primary\n  postgresql/2 [executing] waiting: waiting for primary to be reachable from this unit\n  postgresql/3 [executing] waiting: waiting for primary to be reachable from this unit","time":{"start":1708393696483,"stop":1708395198554,"duration":1502071}},{"uid":"d6c379306c707764","reportUrl":"../2022//#testresult/d6c379306c707764","status":"passed","time":{"start":1708220731434,"stop":1708222450896,"duration":1719462}},{"uid":"58152846539c8e36","reportUrl":"../2019//#testresult/58152846539c8e36","status":"broken","statusDetails":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/0 [executing] active: \n  postgresql/1 [executing] active: Primary\n  postgresql/2 [executing] blocked: no primary in the cluster\n  postgresql/3 [executing] active:","time":{"start":1708134378944,"stop":1708135880932,"duration":1501988}},{"uid":"18b89e9adc28dc78","reportUrl":"../2013//#testresult/18b89e9adc28dc78","status":"passed","time":{"start":1708048043481,"stop":1708049709305,"duration":1665824}},{"uid":"b0d4408acdf87946","reportUrl":"../2008//#testresult/b0d4408acdf87946","status":"broken","statusDetails":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/2 [idle] blocked: no primary in the cluster\n  postgresql/3 [idle] blocked: no primary in the cluster","time":{"start":1707961652011,"stop":1707965757105,"duration":4105094}},{"uid":"4600f5f4a68ab13d","reportUrl":"../1996//#testresult/4600f5f4a68ab13d","status":"broken","statusDetails":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/2 [idle] blocked: no primary in the cluster\n  postgresql/3 [idle] blocked: no primary in the cluster","time":{"start":1707702303752,"stop":1707706311209,"duration":4007457}},{"uid":"8320c6f28b19fe8c","reportUrl":"../1995//#testresult/8320c6f28b19fe8c","status":"passed","time":{"start":1707615932889,"stop":1707618166903,"duration":2234014}},{"uid":"17827969fa8b3b07","reportUrl":"../1993//#testresult/17827969fa8b3b07","status":"passed","time":{"start":1707529595671,"stop":1707531248380,"duration":1652709}},{"uid":"b9b93b34bfe3a4e3","reportUrl":"../1990//#testresult/b9b93b34bfe3a4e3","status":"passed","time":{"start":1707443089268,"stop":1707444217729,"duration":1128461}},{"uid":"a89428feffaf82c","reportUrl":"../1988//#testresult/a89428feffaf82c","status":"broken","statusDetails":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/2 [idle] blocked: no primary in the cluster\n  postgresql/3 [idle] blocked: no primary in the cluster","time":{"start":1707356728439,"stop":1707360735712,"duration":4007273}},{"uid":"1cfa6de4d56717e","reportUrl":"../1973//#testresult/1cfa6de4d56717e","status":"passed","time":{"start":1707270241648,"stop":1707271196211,"duration":954563}},{"uid":"5a5ebeaa15f90854","reportUrl":"../1961//#testresult/5a5ebeaa15f90854","status":"broken","statusDetails":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/2 [idle] blocked: no primary in the cluster\n  postgresql/3 [idle] blocked: no primary in the cluster","time":{"start":1707183972390,"stop":1707187860375,"duration":3887985}},{"uid":"a0be28e3b82b00f8","reportUrl":"../1957//#testresult/a0be28e3b82b00f8","status":"passed","time":{"start":1707097407667,"stop":1707098727190,"duration":1319523}},{"uid":"927e6c72223d3601","reportUrl":"../1956//#testresult/927e6c72223d3601","status":"broken","statusDetails":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/2 [idle] blocked: no primary in the cluster\n  postgresql/3 [idle] blocked: no primary in the cluster","time":{"start":1707011098498,"stop":1707014585638,"duration":3487140}},{"uid":"f458f4561a9ec9ed","reportUrl":"../1955//#testresult/f458f4561a9ec9ed","status":"passed","time":{"start":1706924621363,"stop":1706925814589,"duration":1193226}},{"uid":"d77911c556902bda","reportUrl":"../1939//#testresult/d77911c556902bda","status":"passed","time":{"start":1706753586594,"stop":1706755382556,"duration":1795962}},{"uid":"4aacb67a283c4656","reportUrl":"../1935//#testresult/4aacb67a283c4656","status":"passed","time":{"start":1706671374433,"stop":1706672708304,"duration":1333871}},{"uid":"f78a87d78477d194","reportUrl":"../1928//#testresult/f78a87d78477d194","status":"passed","time":{"start":1706579120538,"stop":1706580756073,"duration":1635535}},{"uid":"dda71869875339b9","reportUrl":"../1917//#testresult/dda71869875339b9","status":"broken","statusDetails":"asyncio.exceptions.TimeoutError: Timed out waiting for model:\npostgresql/2 [idle] blocked: no primary in the cluster\n  postgresql/3 [idle] blocked: no primary in the cluster","time":{"start":1706406403265,"stop":1706410435864,"duration":4032599}}]},"tags":["asyncio","group(1)"]},"source":"743142e1f891cbbf.json","parameterValues":[]}